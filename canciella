<VirtualHost *:80>
  ServerName canciella.net
  ServerAlias *.canciella.net

  RewriteEngine On
  ProxyPassInterpolateEnv On

  RewriteCond %{HTTPS} off
  RewriteCond %{HTTP_HOST} ^(.*).canciella.net$
  RewriteRule ^(.*)$ http://%1/$0 [P,E=HOST:%1,E=PROTOCOL:http]

  RewriteCond %{HTTPS} on
  RewriteCond %{HTTP_HOST} ^(.*).canciella.net$
  RewriteRule ^(.*)$ https://%1/$0 [P,E=HOST:%1,E=PROTOCOL:https]

  ProxyPassReverse / $PROTOCOL://%1 interpolate

</VirtualHost>
